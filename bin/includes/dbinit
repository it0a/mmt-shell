#!/bin/bash
get_db_pass() {
    stty -echo
    printf "Password: "
    read DBPASS
    stty echo
}
attempt_connection() {
    printf "\nAttempting connection to $BCMT_HOST:$BCMT_PORT as user $BCMT_USER..."
    BCMT_DBINITOK=false
    timeout 5s mysql -h $BCMT_HOST -P $BCMT_PORT -u $BCMT_USER -p$DBPASS -e exit 2>/dev/null 
    CONNRESULT=$?
    if [ $CONNRESULT = "0" ]
    then
        BCMT_DBINITOK=true
        printf " OK\n"
    else
        printf " FAIL\n"
        die "Unable to connect to database"
    fi
}
do_dbinit() {
    get_db_pass
    attempt_connection
}
